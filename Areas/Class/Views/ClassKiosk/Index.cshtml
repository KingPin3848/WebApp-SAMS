@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Class Kiosk";
}
@using SAMS.Areas.Class.Controllers
@model SAMS.Areas.Class.Controllers.QRCodeModel

<h1>Class Check-in Kiosk</h1>
<title>@ViewData["Title"]</title>

<h2>Follow the instructions below.</h2>

<p id="instructions" style="color: green;">
    Slide your Student ID card where the QR Code faces upwards (or top) into the card-holder and wait for further instructions.
</p>

@using (Html.BeginForm("Index", "ClassKiosk", FormMethod.Post, new { id = "kioskForm"}))
{
    @Html.AntiForgeryToken()

    <div class="form-floating pb-2">
        <input asp-for="ScannedCode" class="form-control" id="scannedcode" />
        <label asp-for="ScannedCode"></label>
        <span asp-validation-for="ScannedCode" class="text-danger"></span>
    </div>

    <div class="form-floating pb-2">
        <input asp-for="StudentPin" class="form-control" id="studentpin" />
        <label asp-for="StudentPin"></label>
        <span asp-validation-for="StudentPin" class="text-danger"></span>
    </div>

    <div class="form-group pt-4">
        <button type="button" class="btn btn-primary" onclick="getData()">Submit</button>
    </div>
}

<script>
    function getData() {
        var scannedCode = document.getElementById('scannedcode').value;
        var studpin = document.getElementById('studentpin').value;

        sendData(scannedCode, studpin);
    }

    function sendData(ScannedCode, StudentPin) {
        let realdata = {
            'LocalScannedCode': ScannedCode,
            'LocalStudentPin': StudentPin
        };

        let token = $('input[name="__RequestVerificationToken"]').val();

        $.ajax(
            {
                type: "POST",
                url: "@Url.Action("Index", "ClassKiosk")",
                data: realdata,
                headers: {
                    "RequestVerificationToken": token
                },
                success: function (response) {
                    if (response.success == true) {
                        document.getElementById("id").hidden;
                        $('#instructions').text(response.message);
                        setTimeout(function () {
                            location.reload();
                        }, response.seconds);
                    }
                    else {
                        $('#instructions').text(response.message);
                        $('#instructions').css("color","red");
                        setTimeout(function () {
                            location.reload();
                        }, response.seconds);
                    }
                },
                error: function(response) {
                    if (response.success == true) {
                        document.getElementById("id").hidden;
                        $('#instructions').text(response.message);
                        setTimeout(function () {
                            location.reload();
                        }, response.seconds);
                    }
                    else {
                        $('#instructions').text(response.message);
                        $('#instructions').css("color", "red");
                        setTimeout(function () {
                            location.reload();
                        }, response.seconds);
                    }
                }
            }
        )
    }
</script>